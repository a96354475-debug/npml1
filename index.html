<!doctype html>
<html lang="ko">
<head>
<script>
  // ── 자동 캐시버스터: URL에 ?v=YYYYMMDD-HHMM 자동 추가 ──
  (function(){
    try{
      const url = new URL(location.href);
      // 이미 v 파라미터가 있으면 그대로 둠
      if (url.searchParams.has('v')) return;

      // 자동 버전: 현재 한국시간 기준 YYYYMMDD-HHMM
      const pad = n => String(n).padStart(2,'0');
      const now = new Date();
      const krTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9 보정
      const autoVer = krTime.getUTCFullYear()
        + pad(krTime.getUTCMonth() + 1)
        + pad(krTime.getUTCDate())
        + '-' + pad(krTime.getUTCHours())
        + pad(krTime.getUTCMinutes())
        + pad(krTime.getUTCSeconds()); // 초까지 포함

      url.searchParams.set('v', autoVer);
      location.replace(url.toString()); // 뒤로가기 이슈 없게 교체
    }catch(e){
      console.warn('버전 파라미터 자동 추가 실패:', e);
    }
  })();
</script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NPML — Carousel (Iframe Safe)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+KR:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--brand:#004A9F;--border:#e5e7eb;--muted:#475569;--gap:18px}
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a}
    h2{font-family:Montserrat, sans-serif;font-size:28px;margin:0 0 12px}
    .wrap{width:min(1200px,92%);margin:24px auto}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .section{border:1px solid var(--border);border-radius:14px;padding:12px}
    .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .controls{display:flex;gap:8px}
    .btn{width:36px;height:36px;border:1px solid var(--border);background:#fff;border-radius:10px;display:inline-grid;place-items:center;cursor:pointer}
    .btn:active{transform:scale(.98)}
    .btn svg{width:18px;height:18px}
    /* Carousel core */
    .clip{overflow:hidden;border-radius:10px}
    .track{display:flex;gap:var(--gap);will-change:transform;transition:transform .4s ease}
    .card{flex:0 0 calc((100% - var(--gap)*2)/3);border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
    @media (max-width: 1200px){.card{flex-basis:calc((100% - var(--gap))/2)}}
    @media (max-width: 640px){.card{flex-basis:100%}}
    .thumb{aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;background:#fafafa}
    .thumb img{max-width:82%;max-height:82%}
    .body{padding:12px 14px}
    .title{font-weight:700;margin:0 0 6px}
    .meta{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <!-- Research -->
      <section class="section" data-carousel id="research-sec">
        <div class="head">
          <h2>Research Topics</h2>
          <div class="controls">
            <button class="btn" data-prev aria-label="이전">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <button class="btn" data-next aria-label="다음">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
            </button>
          </div>
        </div>
        <div class="clip">
          <div class="track">
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/a/640/360" alt=""></div><div class="body"><h3 class="title">천연물 약리기전</h3><div class="meta">활성 성분 분리·동정</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/b/640/360" alt=""></div><div class="body"><h3 class="title">대사체 바이오마커</h3><div class="meta">LC–MS/NMR</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/c/640/360" alt=""></div><div class="body"><h3 class="title">에너지 대사·섬유화</h3><div class="meta">미토콘드리아 타깃</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/d/640/360" alt=""></div><div class="body"><h3 class="title">신규 화합물</h3><div class="meta">구조·기전 규명</div></div></article>
          </div>
        </div>
      </section>

      <!-- Publications -->
      <section class="section" data-carousel id="pubs-sec">
        <div class="head">
          <h2>Recent Publications</h2>
          <div class="controls">
            <button class="btn" data-prev aria-label="이전">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <button class="btn" data-next aria-label="다음">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
            </button>
          </div>
        </div>
        <div class="clip">
          <div class="track">
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/e/640/360" alt=""></div><div class="body"><h3 class="title">Paper A</h3><div class="meta">Journal · 2025</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/f/640/360" alt=""></div><div class="body"><h3 class="title">Paper B</h3><div class="meta">Journal · 2024</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/g/640/360" alt=""></div><div class="body"><h3 class="title">Paper C</h3><div class="meta">Journal · 2023</div></div></article>
            <article class="card"><div class="thumb"><img src="https://picsum.photos/seed/h/640/360" alt=""></div><div class="body"><h3 class="title">Paper D</h3><div class="meta">Journal · 2022</div></div></article>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Iframe-safe carousel: translateX 기반 (scrollBy 미사용)
    (function(){
      const carousels = document.querySelectorAll('[data-carousel]');
      carousels.forEach(sec => {
        const track = sec.querySelector('.track');
        const cards = Array.from(track.children);
        const prev = sec.querySelector('[data-prev]');
        const next = sec.querySelector('[data-next]');
        let index = 0; // leftmost visible card index
        let visible = 3; // default, will compute
        let cardW = 0;
        let timer = null;

        function compute(){
          const clip = sec.querySelector('.clip');
          const gap = parseFloat(getComputedStyle(track).getPropertyValue('--gap')||18);
          // Estimate how many cards fit: check width
          cardW = cards[0].getBoundingClientRect().width + gap;
          const total = clip.getBoundingClientRect().width + gap;
          visible = Math.max(1, Math.round(total / cardW));
          go(index, false);
        }

        function go(i, animate=true){
          const maxIndex = Math.max(0, cards.length - visible);
          index = Math.min(Math.max(0, i), maxIndex);
          track.style.transitionDuration = animate ? '.4s' : '0s';
          track.style.transform = `translateX(${-index * cardW}px)`;
        }

        function step(dir){
          go(index + dir, true);
        }

        prev.addEventListener('click', () => step(-1));
        next.addEventListener('click', () => step(+1));
        window.addEventListener('resize', compute);

        // auto slide (pause on hover/focus for accessibility)
        function startAuto(){
          if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
          stopAuto();
          timer = setInterval(()=>{
            const maxIndex = Math.max(0, cards.length - visible);
            if (index >= maxIndex) { go(0, true); } else { step(+1); }
          }, 4000);
        }
        function stopAuto(){ if (timer) { clearInterval(timer); timer = null; } }
        sec.addEventListener('mouseenter', stopAuto);
        sec.addEventListener('mouseleave', startAuto);
        sec.addEventListener('focusin', stopAuto);
        sec.addEventListener('focusout', startAuto);

        // init
        compute();
        startAuto();
        // Recompute after images load (layout shifts)
        window.addEventListener('load', compute);
      });
    })();
  </script>
</body>
</html>
